<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="img/favicon.ico" />
    <title>Rationale - Mosaic</title>
    <link rel="stylesheet" href="css/theme.css" />
    <link rel="stylesheet" href="css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="style.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Rationale";
        var mkdocs_page_input_path = "rationale.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href=".">
          <img src="img/favicon-96x96.png" class="logo" alt="Logo"/>
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="./search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption"><span class="caption-text">Introduction</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="index.html">Introduction</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="status.html">Status and Development</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Identity</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="identity.html">Identity</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Location Service</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="bootstrap.html">Bootstrap</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="url.html">URL</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Data Formats</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="timestamps.html">Timestamps</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="core_tags.html">Core Tags</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="record.html">Record Format</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="human_readable_content.html">Human Readable Content</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="reference.html">References</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Client-Server Protocol</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="network.html">Network architecture</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="transport_requirements.html">Transport requirements</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="messages.html">Protocol messages</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="filter.html">Filter</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="sync.html">Sync</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Transport</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="quic.html">QUIC</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="websockets.html">WebSockets</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Accessory</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="human_encodings.html">Human Encodings</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="encrypted_secret_key.html">Encrypted Secret Key</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Registries</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="applications.html">Application Registry</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="kinds.html">Record Kind Registry</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="tag_types.html">Tag Type Registry</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Application: Core</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="keyschedule.html">Key Schedule Record</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="profile.html">Profile Record</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="friends.html">Acquaintences and Friends</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="reporting.html">Reporting</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Application: Mosaic Social Media</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="microblog.html">Microblogging</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="blog.html">Blog</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="reply_comment.html">Reply Comment</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="chat.html">Chat</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Appendices</span></p>
              <ul class="current">
                  <li class="toctree-l1"><a class="reference internal" href="cryptography.html">Cryptography</a>
                  </li>
                  <li class="toctree-l1 current"><a class="reference internal current" href="#">Rationale</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#binary-records">Binary Records</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#blake3">BLAKE3</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#client-server">Client-Server</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#distributed">Distributed</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#duplex-communication">Duplex Communication</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#eddsa-ed25519">EdDSA ed25519</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#mainline-dht">Mainline DHT</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#master-key-subkey">Master-Key Subkey</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#no-ip-privacy">No IP Privacy</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#quic">QUIC</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#records">Records</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#references">References</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#server-identities">Server Identities</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#sovereign">Sovereign</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#storing-received-at-timestamps">Storing received-at timestamps</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#timestamps">Timestamps</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#tls">TLS</a>
    </li>
    </ul>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href=".">Mosaic</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="." class="icon icon-home" aria-label="Docs"></a></li>
          <li class="breadcrumb-item">Appendices</li>
      <li class="breadcrumb-item active">Rationale</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="rationale">Rationale</h1>
<p>For brevity, the rationale for various decisions has been elided from its context and linked
to this page with <a href="#"><sup>rat</sup></a> links.</p>
<table>
<thead>
<tr>
<th>Contents</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="#binary-records">Binary Records</a></td>
</tr>
<tr>
<td><a href="#blake3">BLAKE3</a></td>
</tr>
<tr>
<td><a href="#client-server">Client-Server</a></td>
</tr>
<tr>
<td><a href="#distributed">Distributed</a></td>
</tr>
<tr>
<td><a href="#duplex-communication">Duplex Communication</a></td>
</tr>
<tr>
<td><a href="#eddsa-ed25519">EdDSA ed25519</a></td>
</tr>
<tr>
<td><a href="#mainline-dht">Mainline DHT</a></td>
</tr>
<tr>
<td><a href="#master-key-subkey">Master-Key Subkey</a></td>
</tr>
<tr>
<td><a href="#no-ip-privacy">No IP Privacy</a></td>
</tr>
<tr>
<td><a href="#quic">QUIC</a></td>
</tr>
<tr>
<td><a href="#records">Records</a></td>
</tr>
<tr>
<td><a href="#references">References</a></td>
</tr>
<tr>
<td><a href="#server-identities">Server Identities</a></td>
</tr>
<tr>
<td><a href="#sovereign">Sovereign</a></td>
</tr>
<tr>
<td><a href="#storing-received-at-timestamps">Storing received-at timestamps</a></td>
</tr>
<tr>
<td><a href="#timestamps">Timestamps</a></td>
</tr>
<tr>
<td><a href="#tls">TLS</a></td>
</tr>
</tbody>
</table>
<hr />
<h2 id="binary-records">Binary Records</h2>
<p>The binary record format has been designed for performance and size.</p>
<ul>
<li>The on-network format can be identical to a client's or server's on-disk format</li>
<li>There is no parsing overhead (JSON parsing, for example, is quite expensive)</li>
<li>Signing and verification are in-place and require zero data copies.</li>
<li>Fields from the binary record can be accessed directly without deserialization,
  meaning there is optionally no deserialization or copying needed.</li>
<li>Data is aligned to 8-byte boundaries</li>
<li>Endian order is well specified</li>
</ul>
<p>Here is a comparison to JSON and CBOR (or BEVE or similar).</p>
<table>
<thead>
<tr>
<th>Encoding</th>
<th>Human Readable</th>
<th>Extensible</th>
<th>Parse Speed</th>
<th>Copy to Sign</th>
<th>Size</th>
</tr>
</thead>
<tbody>
<tr>
<td>JSON</td>
<td><strong>yes</strong></td>
<td><strong>yes</strong></td>
<td>slow</td>
<td>copy</td>
<td>largest</td>
</tr>
<tr>
<td>CBOR</td>
<td>no</td>
<td><strong>yes</strong></td>
<td><strong>fast</strong></td>
<td>Maybe</td>
<td><strong>medium</strong></td>
</tr>
<tr>
<td>Binary</td>
<td>no</td>
<td>no</td>
<td><strong>NONE</strong></td>
<td><strong>NO</strong></td>
<td><strong>SMALLEST</strong></td>
</tr>
</tbody>
</table>
<p>Except for human readability, CBOR is better than JSON in cases where extensibility
is needed.</p>
<p>Other than that, binary is better in all respects.</p>
<p>We argue that extensibility of the main record is sufficiently done via record kinds,
tags and content, and therefore extensibility is not needed for this structure (nostr
records have not changed since they were introduced, even though there have been
reasons to do so, and they are even simpler).</p>
<p>We sacrifice:</p>
<ul>
<li>Human readability</li>
<li>Extensibility</li>
</ul>
<p>We gain:</p>
<ul>
<li>Zero parsing required</li>
<li>Zero copying for signing required</li>
<li>Smallest size has been achieved</li>
</ul>
<p>As for human readability, the most cited reason for using JSON, my argument is as follows:
HTTP that is transported with gzip is binary data. Developers never see the gzipped data,
all the tools they work with show them the line-oriented HTTP after gunzip. And I'm not
aware of anybody complaining that gzipped HTTP is binary, not human readable, and therfore
a bad choice. I believe our situation is a close parallel. Even though this specification
specifies the binary encoding of everything, developers do not need to see things that
way (and in fact I may reorganize this specification to separate out the binary encodings).
Developers are instead expected to deal with code structures, those structures being JSON
if they are working in JavaScript.</p>
<p>BTW: JSON also has character encoding ambiguities.</p>
<hr />
<h2 id="blake3">BLAKE3</h2>
<p>This is a very fast hash function with 128-bit security. It is even sometimes faster in
software than hardware versions of SHA-256, and s about 14x as fast as software versions
of SHA-256. It is highly parallelizable and can take advantage of vector instructions.</p>
<p>It's predecessor BLAKE was the most analyzed algorithm during the NIST SHA-3 competition.</p>
<p>EdDSA ed25519 is defined to use SHA-512 and we are using BLAKE3 as a drop-in replacement, so
we have to produce 512-bit hashes. But these   do not need to be in the record. What the
record needs is some way to index and reference it, and part of the hash (at least 256 bits)
is good enough for that purpose.</p>
<p>In BLAKE3, hashes are variable size, and smaller outputs are prefixes of longer outputs.
We utilize this.</p>
<hr />
<h2 id="client-server">Client-Server</h2>
<p>Mosaic uses a client-server architecture.</p>
<p>This is because clients and servers serve different roles.
Clients are an interface to the user, while servers are an interface to shared Internet
accessible data.</p>
<p>Nothing precludes a client from also being a server, and calling itself a node.</p>
<p>Nothing precludes servers running behind NAT and being hole-punched into, although such
a mechanism is not provided for currently (Iroh does a bit more than we need and isn't
AFAIK an open protocol but a single software stack).</p>
<p>Mosaic servers are used in a way that presumes they will be online and available most of
the time. Users functionally declare where their data is, and that "where" needs to be
available to other users over the Internet most of the time.</p>
<p>Mosaic has built-in redundancy across such servers, but nonetheless a machine
that is not even intended or capable of being up all the time (such as a phone or
laptop) makes a poor mosaic server.</p>
<hr />
<h2 id="distributed">Distributed</h2>
<p>Centralized systems have a fatal flaw: they can easily be captured and controlled by people you do not
agree with such as corporate or government censors or hackers. By having a
central point of attack, the entire
system can be taken down or damaged by bad actors.</p>
<p>Mosaic is desgined to be fully distributed, with no centralized points of failure.</p>
<p>There is no central place to bootstrap Mosaic either. We use Mainline DHT's bootstrapping, there are
mutiple bootstrap servers and you can run your own.</p>
<hr />
<h2 id="duplex-communication">Duplex Communication</h2>
<p>We base Mosaic on transport protocols that provide duplex communication such as QUIC and Web
Sockets. This is in opposition to a request-response architecture such as HTTP REST.</p>
<p>This allows either side to initiate an action, which turns out to be a very useful feature.
For example when a new record that matches a user's subscribed filters arrives at the server,
the server can immediately shuttle it to the client. In a request-response architecture, there
would be a delay until the client polled again. And due to the polling nature, the client would
need to make many poll requests even when nothing was ready for them.</p>
<hr />
<h2 id="eddsa-ed25519">EdDSA ed25519</h2>
<p>We chose this elliptic curve because it is the state of the art.</p>
<ul>
<li>It is fast</li>
<li>It is space efficient</li>
<li>It is widely studied</li>
<li>It has very good resistance to side-channel attacks</li>
<li>It does not require point validation</li>
<li>It interoperates with ssh, gpg, TLS, Mainline DHT, and other modern ed25519-based
  identity systems</li>
</ul>
<p>We replaced the hashing algorithm because multiple good cryptographers have indicated that any
secure hashing algorithm that produces hashes of the right size could be used, and we chose
<a href="#blake3">BLAKE3</a>.</p>
<p>We provide a context string so that users cannot be tricked by one application into signing
content for a different application (in case users think they can use the same keypair for
every application).</p>
<p>We added additional checks in order to provide the following guarantees:</p>
<ul>
<li>Existentially and Strongly unforgeable under chosen message attacks</li>
<li>Strongly Binding Signature</li>
</ul>
<p>See <a href="https://eprint.iacr.org/2020/1244.pdf">Taming the many EdDSAs</a></p>
<p>See <a href="https://eprint.iacr.org/2020/823.pdf">The Provable Security of Ed25519: Theory and Practice</a></p>
<hr />
<h2 id="mainline-dht">Mainline DHT</h2>
<p>Mainline DHT is distributed and censorship resistant, including being resistant to (or able
to detect) Sybil attacks. It is the largest (or one of) and longest living DHT.</p>
<p>It also has this mutable data functionality and works with ed25519 signed data.</p>
<h3 id="salt">Salt</h3>
<p>We use the salt to avoid collisions, in case the same ed25519 identity keypair is used by
both mosaic and <a href="https://github.com/pubky">pubky</a>, or in case we need to change the format
of the bootstrap in the future.</p>
<p>We also need different salts because we have two different kinds of bootstraps already.
Different salts allow a server keypair to also be a user keypair without collision.</p>
<p>These salts are short enough to not use too much space.</p>
<p>The user bootstrap salt used to be <code>mub24</code> but was changed to <code>mub25</code> when the format of
printable public keys changed.</p>
<h3 id="sequence-numbers">Sequence Numbers</h3>
<p>We don't need collision protection here because writing this record requires the secure
master key which is likely to be in only one place, and even if copied around we still
do not expect people to write often from multiple places.</p>
<p>We could change to timestamps instead if this becomes a problem and still remain backwards
compatible.</p>
<hr />
<h2 id="master-key-subkey">Master-Key Subkey</h2>
<p>The primary purpose was to allow users to have per-device online keys whil keeping their
master secret offline.</p>
<p>However this design facilities quite a bit more functionality such as:</p>
<ul>
<li>Separate encryption keys</li>
<li>Subkeys using alternate cryptosystems (e.g. secp256k1 nostr keys)</li>
<li>Subkeys as personas, to post about very different things and let people easily follow only
  some of what you post.</li>
</ul>
<hr />
<h2 id="no-ip-privacy">No IP Privacy</h2>
<p>Several IP privacy network layers exist which already do a good job (Tor, i2p, VPNs). The IP privacy
issue is almost entirely orthogonal to the application protocol, and so architecturally it makes sense
to separate application layers from privacy layers. There is no good reason to reinvent another privacy
layer just for Mosaic since Mosaic can run on top of an already existing general-purpose privacy layer.</p>
<hr />
<h2 id="quic">QUIC</h2>
<p>HTTP has a lot of baggage. WebSockets layers on top of that.</p>
<p>What we really need is size-unrestricted datagrams within TLS.  QUIC
gives us that if we do our own framing within a QUIC stream.</p>
<p>QUIC is widely deployed due to its use in HTTP 1.3. QUIC is also much
faster due to fewer roundtrips and no head-of-line blocking, while
taking care of TLS, multiplexed streams, congestion control and other
details that we would not dare to reimplement.</p>
<p>The only concern would be if the port is not opened, and in this case
a server can run on UDP port 443 (even though it is not speaking HTTP).</p>
<hr />
<h2 id="records">Records</h2>
<h3 id="maximum-size">Maximum Size</h3>
<p>This is specified so that length fields inside of records can be of a defined fixed number
of bits and so that software can make reasonable decisions about buffer sizes.</p>
<h3 id="layout">Layout</h3>
<p>Record layout provides a compromise between being tightly packed and providing 64-bit
alignment of fields.</p>
<p>All data that needs hashing is contigous so that no data needs to be copied in order to produce
the hash. The hash-based id and signature could have appeared before or after, and we have chosen
to place them before to give them well defined offsets.</p>
<h3 id="flags">Flags</h3>
<p>A number of record properties that span applications have been conceived of and we
provided space to set these.</p>
<h3 id="duplicate-timestamp">Duplicate Timestamp</h3>
<p>We have the timestamp twice.</p>
<p>We have it in the ID so that IDs sort in timestamp order.</p>
<p>But IDs are not hashed and signed. So we have to duplicate it in the main part of the record.</p>
<h3 id="tags">Tags</h3>
<p>Tag values should not be too large as they need to be indexed by relays.</p>
<p>Constraining the value to 253 bytes allows an entire TLV (with 16-bit type and 8-bit length) to
fit within 256 bytes.</p>
<p>While for some tag types a length could be inferred, this is not true in general. Applications
should not be required to recognize every tag type to look up its known length or type-specific
method of length calculation.</p>
<p>Tags specify a value length not a length of the whole tag. This allows tags of 256 bytes in length
to be represented (with a value length of 253). Otherwise a tag of such length could not fit
its length (256) into a single byte. Value lengths &gt; 253 MUST be considered invalid.</p>
<p>Some tag types start with padding in the value in order to better align their data.</p>
<hr />
<h2 id="references">References</h2>
<h3 id="id-fields">Id Fields</h3>
<p>The hash in the ID cryptographically represents all the data that was hashed.
It is 40 bytes long because we needed at least 32 bytes for cryptographic
reasons, and because addresses are already 48 bytes long, we used the extra
8 bytes to extend the hash.</p>
<p>The entire 512-bit (64 byte) hash is overkill. Even though we have to produce
it for the EdDSA ed25519 signature, we don't have to waste precious record
space with that entire long hash.</p>
<p>By putting the big-endian timestamp at the front of the ID, IDs sort in time
order and group temporally (for database performance).</p>
<h3 id="address-fields">Address Fields</h3>
<p>By not including the hash of content, records can be edited and replaced by
the author (where edits make sense). Application will specify which kind of
reference to use in which context.</p>
<p>By containing the Author public key, record location can be determined
through <a href="bootstrap.html">bootstrapping</a>.</p>
<p>By containing the kind, records that are edited cannot change their kind.</p>
<p>By containing the kind, software can filter records that are not relevant to
a situation without needing to look them up first.</p>
<p>By containing a long unique nonce, it is statistically infeasible for two
different records to have the same address unintentionally. In fact this is
overkill, but we had the space due to alignment requirements.</p>
<p>By not specifying how the nonce is generated, applications can solve different
problems with different requirements.</p>
<p>At only 48 bytes long, these can easily fit into a 253 byte tag when needed
and are the same size as an ID.</p>
<p>By the first bit being a 1, IDs and ADDRs can be intermixed and their type
determined by that bit.</p>
<p>--</p>
<h2 id="server-identities">Server Identities</h2>
<p>By recognizing a server by it's key, we can verify server identity directly.</p>
<ul>
<li>We no longer need to trust DNS, that it gave us the right IP address</li>
<li>We no longer need to trust Certification Authorities, that the DNS to IP address binding
  is correct.</li>
</ul>
<p>Additionally, servers can now present themselves at multiple transport endpoints. They can
also hop from endpoint to endpoint if they are being actively targetted.</p>
<p>By having a strong form of identification, clients can maintain reliable reputational
information about servers even as they move to different endpoints.</p>
<hr />
<h2 id="sovereign">Sovereign</h2>
<p>Ethically, we believe in free speech and empowering individuals.</p>
<p>All participation is self-managed and nobody can cancel your account. You manage your own keys.</p>
<p>This allows users to be independent of any service provider and to change the servers they use at
any time.</p>
<p>Mosaic does not depend on upstream DNS providers and Mosaic does not depend on Certification Authorities
to issue certificates.</p>
<p>We use a dumb-server smart-client model in order to push as much control into the user's realm (the client
space) as feasible.</p>
<hr />
<h2 id="storing-received-at-timestamps">Storing received-at timestamps</h2>
<p>We require clients and servers to store this information for two reasons.</p>
<p>The first and most important is for key revocation. Revocation can't be applied to only
records in the past judged by timestamps in the records themselves because those
timestamps can be forged. By remembering when a record was received, an upper time
bound is established, and records prior to that bound can continue to be trusted while
records after that bound can be invalidated.</p>
<p>Secondly, when synchronizing with a relay, clients want to ask for records they
have not gotten yet. They can use this received-at data to avoid missing records
that were timestamped earlier but arrived later than the last time they checked for
records.</p>
<hr />
<h2 id="timestamps">Timestamps</h2>
<h3 id="leap-seconds">Leap Seconds</h3>
<p>Unixtime is a discontinous time scale that is occasionally adjusted by leap seconds.
Subtracting two unixtimes could give a time interval that is off by up to 28 seconds
(for example when comparing dates before 1 Jan 1972 with today).</p>
<h3 id="nanoseconds">Nanoseconds</h3>
<p>32 bytes do not provide enough space for sub-second precision. Once you choose to use
the next larger integer (u64) you get plenty of numeric space. Thus we use it for
nanosecond precision, even if nobody needs to be that precise.</p>
<h3 id="big-endian">Big Endian</h3>
<p>Timestamps are stored in big-endian format so that they sort in time order even when
they are interpreted as a simple sequence of bytes (lexigraphically).</p>
<h3 id="timestamp-ranges">Timestamp Ranges</h3>
<p>Timestamp ranges are inclusive on both ends. This is because they are usually iterated
backwards (from the newest to the oldest) and if we made the oldest one exclusive (as
a normal range would do) it would easily suprise many people who would expect the
until to be the exclusive one. Also, timestamps are fine enough that including one extra
nanosecond has little practical effect.</p>
<hr />
<h2 id="tls">TLS</h2>
<p>We use TLS security because it is heavily researched and state-of-the-art.</p>
<p>But we don't use the X.509 certificates as intended since both client and server are known by
their public keys, not by DNS names.  Instead we use RawPublicKey or self-signed certificates.</p>
<p>Clients are authenticated via client-side certificates.</p>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="cryptography.html" class="btn btn-neutral float-left" title="Cryptography"><span class="icon icon-circle-arrow-left"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  <div>
    <i>Mike Dilger edition, version 0.1.0</i>
  </div>
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="cryptography.html" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
  </span>
</div>
    <script src="js/jquery-3.6.0.min.js"></script>
    <script>var base_url = ".";</script>
    <script src="js/theme_extra.js"></script>
    <script src="js/theme.js"></script>
      <script src="search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
